% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/stats.R
\name{compute_mohns_rho}
\alias{compute_mohns_rho}
\title{Compute Mohn's rho for retrospective analyses}
\usage{
compute_mohns_rho(data)
}
\arguments{
\item{data}{A data frame with columns (e.g., data frames in \code{pop} output from \code{\link[=fit_retro]{fit_retro()}}):
\itemize{
\item \strong{year}: integer or numeric assessment year of the estimate.
\item \strong{fold}: integer or numeric label for the retrospective peel
(typically the terminal year of the dataset used for that run).
\item \strong{est}: numeric estimate (e.g., SSB, F, recruitment) on which
Mohn's rho is calculated.
\item \strong{is_proj}: logical; \code{TRUE} for projection rows, \code{FALSE} otherwise.
}}
}
\value{
A single numeric value: the mean proportional difference (Mohn's rho).
Returns \code{NA} if no valid pairs are available.
}
\description{
Calculates Mohn's rho (the average proportional retrospective bias)
from a long-format data frame containing terminal and peeled estimates
across retrospective runs.
}
\details{
The function:
\enumerate{
\item Coerces \code{fold} to numeric.
\item If \code{max(year) > max(fold)}, adds 1 to \code{fold} to handle
conventions where each peel's estimate is reported for the
subsequent calendar year (i.e., “stepped forward by one year”).
\item Identifies terminal estimates (\code{fold == max(fold)}) as the
reference series.
\item For each peel, extracts the estimate at the peel year
(\code{year == fold}) and merges with the terminal estimate for the
same year.
\item Computes proportional difference
\deqn{\rho = \frac{ \text{est}_{\text{retro}} - \text{est}_{\text{terminal}} }
               { \text{est}_{\text{terminal}} }}
and returns the mean across peels.
}

Observations with zero terminal estimates will produce \code{Inf}/\code{NaN}
in the proportional difference; consider filtering or transforming
input accordingly if this is a concern.
}
\examples{
df <- data.frame(
  year = rep(2010:2015, each = 3),
  fold = rep(c(2013, 2014, 2015), times = 6),
  est = c(100, 105, 110, 90, 95, 100, 85, 92, 98,
          80, 90, 95, 78, 88, 93, 76, 86, 91),
  is_proj = FALSE
)
compute_mohns_rho(df)

}
\references{
Mohn, R. (1999). The retrospective problem in sequential population analysis:
An investigation using cod fishery and simulated data. \emph{ICES Journal of
Marine Science}, 56(4), 473–488.
}
